jQuery(document).ready((function(r){"use strict";let e={action:"wvr_action",security:wvrParams.security},t=!1,o=r('<div class="wvr-add-review-progress-bar" data-percent="75">\n                            <div class="wvr-bar">\n                                <div class="wvr-progress">0%</div>\n                            </div>\n                        </div>');const s=r=>{o.find(".wvr-bar").css("width",`${r}%`),o.find(".wvr-progress").text(`${r}%`)},c=a=>{let n=a;r.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{sub_action:"add_review_from_product_page",...e,...a},success(e){if(e.success){let{percent:i,error_products:d={},step:l}=e.data;if(s(i),l?(a={...n,...e.data},c(a)):(t=!1,r(".wvr-products-error-list").html()&&r(".wvr-products-error-section").show(),setTimeout((()=>o.remove()),2e3)),Object.keys(d).length){r(".wvr-products-error-button").show();let e=r(".wvr-products-error-list");for(let r in d)e.append(`<li>${d[r]}</li>`)}}},error(r){console.log(r)}})};r("body").on("click",(function(e){0===r(e.target).closest(".wvr-control-panel").length&&(r(".wvr-add-review-control").removeClass("wvr-open"),r(".wvr-products-error-section").hide())})).on("click",".wvr-products-error-button",(function(){r(".wvr-products-error-section").toggle()})),r(".wvr-open-add-review-control-panel").on("click",(function(){r(".wvr-add-review-control").toggleClass("wvr-open")})),r(".submit-add-reviews").on("click",(function(e){if(t)return;let a=r("input:checkbox[id^='cb-select-']:checked");if(!a.length)return void alert("You have to select at least one product");let n=r(".wvr-select-qty-cmt").val(),i=r(".wvr-date-from").val(),d=r(".wvr-date-to").val();if(!(n&&i&&d))return void alert("Params are invalid");if(!confirm(`Do you want to add ${n} comment(s) per product?`))return;let l=a.map(((r,e)=>e.value)).toArray();l=l.filter((r=>"on"!==r)),r(".wp-list-table").before(o),r(".wvr-add-review-control").removeClass("wvr-open"),t=!0,s(0),r(".wvr-products-error-list").empty(),c({pids:l,quantity:n,from:i,to:d})}))}));