jQuery(document).ready((function(e){"use strict";let i=e("body"),s={action:"wvr_action",security:wvrParams.security},l=e("#wvr-schedules-section"),n=0,a="",t=wvrParams.weekday.map(((e,i)=>`<option value="${i}">${e}</option>`)).join(""),d=[...Array(31).keys()].map((e=>`<option value="${e+1}">${e+1}</option>`)).join(""),r=Object.entries(wvrParams.repeatTypes).map((e=>`<option value="${e[0]}">${e[1]}</option>`)).join("");l.sortable({handle:".wvr-sort-handler",axis:"y",placeholder:"wvr-sortable-placeholder",start:function(e,i){i.placeholder.height(i.helper[0].scrollHeight)}});for(let e in wvrParams.categories)a+=`<option value="${e}">${wvrParams.categories[e]}</option>`;const c=i=>{let{rule_name:l="New rule",products:c=[],exclude_products:o=[],quantity:v=5,quantity_from:u=1,quantity_to:p=3,product_limit_from:w="",product_limit_to:h="",active:m="",accordionActive:f=!1,date_from:_="",date_to:y="",time_from:g="12:00 AM",time_to:$="11:59 PM"}=i;void 0===i.quantity_to&&(p=v);let b="",x="";if(f=f?"active":"",m=m?"checked":"",c.length)for(let e of c)wvrParams.productList[e]&&(b+=`<option value="${e}" selected>${wvrParams.productList[e]}</option>`);if(o.length)for(let e of o)wvrParams.productList[e]&&(x+=`<option value="${e}" selected>${wvrParams.productList[e]}</option>`);let k=e(`<div class="vi-ui styled fluid accordion wvr-schedule-rule-row">\n    <div class="${f} title">\n        <i class="dropdown icon"></i>\n        <div class="vi-ui toggle checkbox">\n            <input type="checkbox" name="wvr_schedule_rules[${n}][active]" value="1" ${m}>\n            <label></label>\n        </div>\n        <div class="wvr-schedule-rule-title-group">\n            <input type="text" name="wvr_schedule_rules[${n}][rule_name]" value="${l}" class="wvr-schedule-rule-title fluid"/>\n        </div>\n        <i class="arrows alternate icon wvr-sort-handler"> </i>\n        <i class="x icon wvr-remove-rule"> </i>\n    </div>\n    <div class="${f} content">\n        <div class="vi-ui form small">\n            <div class="fields">\n                <p class="three wide field">Categories</p>\n                <div class="thirteen wide field">\n                    <select multiple name="wvr_schedule_rules[${n}][categories][]" class="vi-ui dropdown fluid wvr-schedule-rule-include-categories">\n                        ${a}\n                    </select>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Exclude Categories</p>\n                <div class="thirteen wide field">\n                    <select multiple name="wvr_schedule_rules[${n}][exclude_categories][]" class="vi-ui dropdown fluid wvr-schedule-rule-exclude-categories">\n                        ${a}\n                    </select>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Products</p>\n                <div class="thirteen wide field">\n                    <select multiple name="wvr_schedule_rules[${n}][products][]" class="wvr-product-search">\n                        ${b}\n                    </select>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Exclude Products</p>\n                <div class="thirteen wide field">\n                    <select multiple name="wvr_schedule_rules[${n}][exclude_products][]" class="wvr-product-search">\n                        ${x}\n                    </select>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Review quantity / product / day </p>\n                <div class="thirteen wide field">\n                    <div class="fields">\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">From</span>\n                            <input type="number" min="1" step="1" name="wvr_schedule_rules[${n}][quantity_from]" value="${u}">\n                        </div>\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">To</span>\n                            <input type="number" min="1" step="1" name="wvr_schedule_rules[${n}][quantity_to]" value="${p}">\n                        </div>\n                    </div>\n                    <p>Random once per day, all products in this rule will be use this randomed quantity.</p>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Product limit each add review</p>\n                <div class="thirteen wide field">\n                    <div class="fields">\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">From</span>\n                            <input type="number" min="0" step="1" name="wvr_schedule_rules[${n}][product_limit_from]" value="${w}">\n\n                        </div>\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">To</span>\n                            <input type="number" min="0" step="1" name="wvr_schedule_rules[${n}][product_limit_to]" value="${h}">\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="fields">\n                <p class="three wide field">Date</p>\n                <div class="thirteen wide field">\n                    <div class="fields">\n                        <div class="four wide field">\n                            <select name="wvr_schedule_rules[${n}][repeat_type]" class="vi-ui dropdown wvr-repeat-type">\n                                ${r}\n                            </select>\n                        </div>\n                        <div class="twelve wide field">\n                            <div class="wvr-day-options">\n                                <hr/>\n                            </div>\n                        </div>\n                    </div>\n\n                    <label>Time in a day</label>\n                    <div class="fields">\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">From</span>\n                            <div class="vi-ui calendar wvr-time-from">\n                                <div class="vi-ui input left icon">\n                                    <i class="calendar icon"> </i>\n                                    <input type="text" name="wvr_schedule_rules[${n}][time_from]" value="${g}" required>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">To</span>\n                            <div class="vi-ui calendar wvr-time-to">\n                                <div class="vi-ui input left icon">\n                                    <i class="calendar icon"> </i>\n                                    <input type="text" name="wvr_schedule_rules[${n}][time_to]" value="${$}" required>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <label>Date range</label>\n                    <div class="fields">\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">From</span>\n                            <div class="vi-ui calendar wvr-date-from">\n                                <div class="vi-ui input left icon">\n                                    <i class="calendar icon"> </i>\n                                    <input type="text" name="wvr_schedule_rules[${n}][date_from]" value="${_}">\n                                </div>\n                            </div>\n                        </div>\n                        <div class="eight wide field">\n                            <span class="wvr-date-range-label">To</span>\n                            <div class="vi-ui calendar wvr-date-to">\n                                <div class="vi-ui input left icon">\n                                    <i class="calendar icon"> </i>\n                                    <input type="text" name="wvr_schedule_rules[${n}][date_to]" value="${y}">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>`);k.vi_accordion({selector:{trigger:".dropdown.icon"}}),k.find(".wvr-schedule-rule-include-categories").viDropdown({placeholder:"All categories"}),k.find(".wvr-schedule-rule-exclude-categories").viDropdown({placeholder:"No category"});let P=n;k.find(".wvr-repeat-type").viDropdown({onChange(i){switch(k.find(".wvr-date-from input").attr("required",!1),k.find(".wvr-date-to input").attr("required",!1),i){case"none":k.find(".wvr-day-options").html("<hr/>"),k.find(".wvr-date-from input").attr("required",!0),k.find(".wvr-date-to input").attr("required",!0);break;case"daily":k.find(".wvr-day-options").html("<hr/>");break;case"weekly":const i=e(`<select name="wvr_schedule_rules[${P}][repeat_weekday][]" class="fluid wvr-repeat-weekday" multiple>${t}</select>`);k.find(".wvr-day-options").html(i.viDropdown());break;case"monthly":const s=e(`<select name="wvr_schedule_rules[${P}][repeat_day][]" class="fluid wvr-repeat-day" multiple>${d}</select>`);k.find(".wvr-day-options").html(s.viDropdown())}}});let C=k.find(".wvr-date-from"),q=k.find(".wvr-date-to");C.viCalendar({type:"date",endCalendar:q}),q.viCalendar({type:"date",startCalendar:C});let j=k.find(".wvr-time-from"),D=k.find(".wvr-time-to");return j.viCalendar({type:"time",endCalendar:D}),D.viCalendar({type:"time",startCalendar:j}),k.find(".wvr-product-search").select2({width:"100%",multiple:!0,placeholder:"Search products",ajax:{url:wvrParams.ajaxUrl,dataType:"json",type:"POST",quietMillis:50,delay:250,data:e=>({...s,sub_action:"search_product",keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:e=>e,minimumInputLength:2}),k.find(".select2-search__field").css("width","100%"),n++,k};if(i.on("click",".wvr-remove-rule",(function(){e(this).closest(".wvr-schedule-rule-row").remove()})).on("click",".wvr-remove-schedule",(function(){if(!confirm("Do you want to remove this schedule?"))return;let i=e(this),l=e(this).data("timestamp"),n=e(this).data("key"),a=e(this).closest(".wvr-schedule-row");i.hasClass("circle notch")||e.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{...s,sub_action:"remove_single_schedule",timestamp:l,key:n},beforeSend(){i.addClass("circle notch")},success(e){e.success&&a.remove(),i.removeClass("circle notch")}})})).on("click",".wvr-remove-all-schedule",(function(){if(!confirm("Do you want to remove all schedules?"))return;let i=e(this).find("i.icon");e.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{...s,sub_action:"remove_all_schedule"},beforeSend(){i.addClass("circle notch")},success(s){s.success&&e(".wvr-running-schedules").empty(),i.removeClass("circle notch")}})})),e(".wvr-add-schedule-rule").on("click",(function(){let e=c({accordionActive:!0});l.append(e)})),wvrParams.schedules.length){let e=0;for(let i of wvrParams.schedules){0==e++&&(i.accordionActive=!0);let s=c(i);l.append(s),s.find(".wvr-schedule-rule-include-categories").viDropdown("set selected",i.categories),s.find(".wvr-schedule-rule-exclude-categories").viDropdown("set selected",i.exclude_categories),s.find(".wvr-repeat-type").viDropdown("set selected",i.repeat_type).trigger("change"),s.find(".wvr-repeat-weekday").viDropdown("set selected",i.repeat_weekday),s.find(".wvr-repeat-day").viDropdown("set selected",i.repeat_day)}}else e(".wvr-add-schedule-rule").trigger("click")}));