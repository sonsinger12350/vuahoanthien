jQuery(document).ready((function(e){"use strict";let r={action:"wvr_action",security:wvrParams.security};e(".wvr-products-search").each((function(){let t=e(this).attr("placeholder");e(this).select2({width:"100%",multiple:!0,placeholder:t,ajax:{url:wvrParams.ajaxUrl,dataType:"json",type:"POST",quietMillis:50,delay:500,data:e=>({...r,sub_action:"search_product",keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:e=>e,minimumInputLength:2})}));const t={init(){this.form=e("#wvr-custom-review"),this.progressbar=this.form.find(".wvr-processing-bar"),this.form.on("click",".wvr-add-review",(e=>this.addReview(e))),e("#wvr-single-picker-time").viCalendar({ampm:!1}),e(".wvr-rating").viDropdown()},addReview(t){let a=e(t.target);if(a.hasClass("loading"))return;let i=this.form,s=0;if([".wvr-products",".wvr-review",".wvr-author"].forEach((function(e){let r=i.find(e);r.removeClass("wvr-error"),r.hasClass("select2-hidden-accessible")&&r.next().removeClass("wvr-error");let t=r.val();t&&0!==t.length||(s++,r.addClass("wvr-error"),r.hasClass("select2-hidden-accessible")&&r.next().addClass("wvr-error"))})),s)return;let d={sub_action:"add_custom_reviews",pids:i.find(".wvr-products").val(),time:i.find(".wvr-time").val(),cmt:i.find(".wvr-review").val(),author:i.find(".wvr-author").val(),rating:i.find(".wvr-rating").viDropdown("get value")};e.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{...r,...d},beforeSend(){a.addClass("loading")},success(e){a.removeClass("loading")},error(e){}})}};({init(){let r=e("#wvr-date-start"),t=e("#wvr-date-end");r.viCalendar({type:"date",endCalendar:t}),t.viCalendar({type:"date",startCalendar:r}),e(".wvr-include-product-cat").viDropdown({placeholder:"All categories",fullTextSearch:!0}),e(".wvr-exclude-product-cat").viDropdown({placeholder:"No category",fullTextSearch:!0}),this.processing=!1,this.form=e("#wvr-review-from-setting"),this.progressbar=e("#wvr-processing-bar"),this.qtyNotice=e("<span>Quantity is invalid</span>"),this.form.on("click",".wvr-add-multi-reviews",(()=>this.addMultiReview())),e(".wvr-use-quantity-range").on("change",this.useQuantityRange)},addMultiReview(){let r=e(".wvr-use-quantity-range").is(":checked"),t=null,a=null,i=null;if(r){let r=e(".wvr-review-per-product-from"),i=e(".wvr-review-per-product-to");if(t=+r.val(),a=+i.val(),t<1||t>50)return void r.after(this.qtyNotice);if(a<1||a>50)return void i.after(this.qtyNotice)}else{let e=this.form.find(".wvr-review-per-product");if(i=+e.val(),i<1)return void e.after(this.qtyNotice)}if(this.processing)return;if(this.progressbar.hide(),e(".wvr-error-product-list-wrapper").hide(),e(".wvr-error-products").html(""),!confirm("Do you want to add reviews?"))return;this.processing=!0,this.progressbar.viProgress({percent:0}),this.progressbar.show();let s={sub_action:"add_multiple_reviews",use_random_quantity:r,qty:i,from_qty:t,to_qty:a,include_cats:this.form.find(".wvr-include-product-cat").viDropdown("get value"),exclude_cats:this.form.find(".wvr-exclude-product-cat").viDropdown("get value"),include_products:this.form.find(".wvr-include-products").val(),exclude_products:this.form.find(".wvr-exclude-products").val(),from:this.form.find(".wvr-date-from").val(),to:this.form.find(".wvr-date-to").val(),step:1};this.ajaxAddReview(s)},ajaxAddReview(t){let a=t,i=this;e.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{...r,...a},success(r){if(console.log(r),r.success){let{percent:s,error_products:d={},step:o,next_lang:n,paged:l}=r.data;if(i.progressbar.viProgress({percent:+s}),o?(t={...a,...r.data},i.ajaxAddReview(t)):n?(setTimeout((()=>i.progressbar.viProgress({percent:0})),500),o=1,l=1,t={...a,...r.data,step:o,paged:l},i.ajaxAddReview(t)):i.processing=!1,Object.keys(d).length){e(".wvr-error-product-list-wrapper").show();let r=e(".wvr-error-products");for(let e in d)r.append(`<li>${d[e]}</li>`)}}}})},useQuantityRange(){let t=e(this).is(":checked");t?(e(".wvr-random-quantity-field").show(),e(".wvr-fixed-quantity-field").hide()):(e(".wvr-fixed-quantity-field").show(),e(".wvr-random-quantity-field").hide()),e.ajax({url:wvrParams.ajaxUrl,type:"post",dataType:"json",data:{...r,stt:t,sub_action:"use_quantity_range"},success(e){}})}}).init(),t.init()}));