jQuery(document).ready((function(e){"use strict";let t={action:"wvr_action",security:wvrParams.security},a=0,n=0,r=e(".wvr-review-rules-section");r.sortable({handle:".wvr-sort-handler",axis:"y",placeholder:"wvr-sortable-placeholder",start:function(e,t){t.placeholder.height(t.helper[0].scrollHeight)}}),e(".wvr-dropdown").each((function(){let t=e(this).attr("placeholder");e(this).viDropdown({placeholder:t})})),e(".vi-ui.menu .item").viTab({history:!0}),e(".wvr-color-picker").colorPicker(),e(".wvr-rating-rate").on("change",(function(){a=0,e(".wvr-rating-rate").each((function(t,n){let r=e(n).val();a+=+r}));let t=100===a?"green":"red",n=100===a?"unset":"1px solid red";e(".wvr-rating-rate-total").css({color:t,outline:n}),e(".wvr-rating-rate-total-value").text(a)})).trigger("change"),e("#wvr-settings-form").on("submit",(()=>100===a)),e(".villatheme-get-key-button").one("click",(function(t){let a=e(this);a.addClass("loading");let n,r=a.data(),l=r.id,i=r.href,s=window.location.hostname;s=s.toLowerCase(),t.preventDefault(),a.attr("data-download"),n=window.open(i,"myWindow","width=380,height=600"),window.addEventListener("message",(function(t){let n=e.parseJSON(t.data),r="",i=n.message,o="",d="";if(n.data.length>0){for(let e=0;e<n.data.length;e++)if(n.data[e].id===l&&(n.data[e].domain===s||""===n.data[e].domain||null==n.data[e].domain)&&((""==r||o<n.data[e].support_until)&&(r=n.data[e].download_key,o=n.data[e].support_until),n.data[e].domain===s)){r=n.data[e].download_key;break}r&&(d=1,e(".villatheme-autoupdate-key-field").val(r))}a.removeClass("loading"),d?(e("<p><strong>"+i+"</strong></p>").insertAfter(".villatheme-autoupdate-key-field"),e(a).closest("form").submit()):e("<p><strong> Your key is not found. Please contact support@villatheme.com </strong></p>").insertAfter(".villatheme-autoupdate-key-field")}))})),e("body").on("click",".wvr-remove-lang-row",(function(){e(this).closest(".wvr-lang-textarea-row").remove()})).on("click",".wvr-remove-language",(function(){e(this).closest(".wvr-language-row").remove()})).on("click",".wvr-remove-rule",(function(){e(this).closest(".wvr-review-rule-row").remove()})).on("click",".wvr-translate",(function(){let t=e(this).data("lang"),a=e(this).closest(".wvr-translatable-section");for(let e=1;e<=5;e++){let n=a.find(`[data-source=default_${e}]`).text().split(/\r?\n/).filter((e=>e));n=n.map(((e,a)=>new Promise(((a,n)=>{fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en-US&tl=${t}&hl=en-US&dt=t&dt=bd&dj=1&source=input&q=${e}`).then((e=>e.json())).then((e=>{let t=e.sentences[0].trans;a(t)})).catch((e=>n(e)))})))),Promise.all(n).then((n=>{a.find(`[data-source=${t}_${e}]`).val(n.join("\n"))})).catch((e=>{console.log(e)}))}}));{let a="";for(let e in wvrParams.categories)a+=`<option value="${e}">${wvrParams.categories[e]}</option>`;let l="";for(let e in wvrParams.languages)l+=`<option value="${e}">${wvrParams.languages[e]}</option>`;const i=(e,t="",a="default",n=[])=>{let r="default"!==a?`<i class="dashicons dashicons-translation wvr-translate" data-lang="${a}"> </i><i class="x icon wvr-remove-language"> </i>`:"";const l=t=>{let r=n[t]&&Array.isArray(n[t])?n[t].join("\n"):"";return`<div class="field">\n                        <p>Review for ${t} &#9733;</p>\n                        <textarea name="wvr_review_rules[${e}][comments][${a}][${t}]" data-source="${a}_${t}" >${r}</textarea>\n                    </div>`};return`<div class="accordion wvr-language-row ${0===wvrParams.languages.length&&"default"!==a?"wvr-hidden":""}">\n                    <div class="active title">\n                        <i class="dropdown icon"></i>\n                        <span class="wvr-language-title">${t}</span>\n                        ${r}\n                    </div>\n                    <div class="active content">\n                        ${l(5)}\n                        ${l(4)}\n                        <div class="three fields">\n                              ${l(3)}\n                              ${l(2)}\n                              ${l(1)}\n                        </div>\n                    </div>\n                </div>`},s=({rule_name:r="New rule",rule_id:s="",products:o=[],exclude_products:d=[],comments:c=[],active:v=!1})=>{let u="",w="";if(v=v?"active":"",s=s||Date.now(),o.length)for(let e of o)wvrParams.productList[e]&&(u+=`<option value="${e}" selected>${wvrParams.productList[e]}</option>`);if(d.length)for(let e of d)wvrParams.productList[e]&&(w+=`<option value="${e}" selected>${wvrParams.productList[e]}</option>`);let g="";if(Object.keys(c).length)for(let e in c){let t=wvrParams.languages[e]||"";Object.keys(wvrParams.languages).length&&!t&&(t="Default language"),g+=i(n,t,e,c[e])}else g=i(n);let p=e(`<div class="vi-ui styled fluid accordion wvr-review-rule-row">\n                        <div class="${v} title">\n                            <i class="dropdown icon"></i>\n                            <div class="wvr-review-rule-title-group">\n                                <input type="hidden" name="wvr_review_rules[${n}][rule_id]" value="${s}" class="wvr-review-rule-title"/>\n                                <input type="text" name="wvr_review_rules[${n}][rule_name]" value="${r}" class="wvr-review-rule-title"/>\n                            </div>\n                            <i class="arrows alternate icon wvr-sort-handler"> </i>\n                            <i class="x icon wvr-remove-rule"> </i>\n                        </div>\n                        <div class="${v} content">\n                            <h4 class="vi-ui header">Condition</h4>\n                            <div class="vi-ui form small">\n                                <div class="fields">\n                                    <p class="three wide field">Categories</p>\n                                    <div class="thirteen wide field">\n                                        <select multiple name="wvr_review_rules[${n}][categories][]" class="vi-ui dropdown fluid wvr-review-rule-include-categories"> \n                                            ${a}\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="fields">\n                                    <p class="three wide field">Exclude Categories</p>\n                                    <div class="thirteen wide field">\n                                        <select multiple name="wvr_review_rules[${n}][exclude_categories][]" class="vi-ui dropdown fluid wvr-review-rule-exclude-categories"> \n                                            ${a}\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="fields">\n                                    <p class="three wide field">Products</p>\n                                    <div class="thirteen wide field">\n                                        <select multiple name="wvr_review_rules[${n}][products][]" class="wvr-product-search">\n                                            ${u}\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="fields">\n                                    <p class="three wide field">Exclude Products</p>\n                                    <div class="thirteen wide field">\n                                        <select multiple name="wvr_review_rules[${n}][exclude_products][]" class="wvr-product-search"> \n                                            ${w}\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n            \n                            <h4 class="vi-ui header">Review content</h4>\n                            <div class="wvr-review-content-section wvr-translatable-section">\n                                ${g}\n                            </div>\n                            ${l?`<div class="vi-ui action input">\n                                <select class="vi-ui compact search dropdown fluid wvr-language-list">\n                                    <option value="">Add review in other language</option>\n                                    ${l}\n                                </select>\n                                <div class="vi-ui button icon wvr-add-review-content-language" data-index="${n}"><i class="icon plus"> </i></div>\n                            </div>`:""}\n                        </div>\n                    </div>`);p.vi_accordion({selector:{trigger:".dropdown.icon"}}),p.find(".wvr-review-rule-include-categories").viDropdown({placeholder:"All categories"}),p.find(".wvr-review-rule-exclude-categories").viDropdown({placeholder:"No category"}),p.find(".wvr-product-search").select2({width:"100%",multiple:!0,placeholder:"Search products",ajax:{url:wvrParams.ajaxUrl,dataType:"json",type:"POST",quietMillis:50,delay:250,data:e=>({...t,sub_action:"search_product",keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:e=>e,minimumInputLength:2}),p.find(".select2-search__field").css("width","100%");let m=p.find(".wvr-language-list").viDropdown({clearable:!0});return p.on("click",".wvr-add-review-content-language",(function(){let t=m.viDropdown("get value"),a=m.viDropdown("get text"),n=e(this).attr("data-index");if(t){let e=i(n,a,t);p.find(".wvr-review-content-section").append(e),m.viDropdown("clear")}})),n++,p};if(e(".wvr-add-review-rule").on("click",(function(){r.append(s({active:!0}))})),wvrParams.settings.review_rules.length){let e=0;for(let t of wvrParams.settings.review_rules){0==e++&&(t.active=!0);let a=s(t);r.append(a),a.find(".wvr-review-rule-include-categories").viDropdown("set selected",t.categories),a.find(".wvr-review-rule-exclude-categories").viDropdown("set selected",t.exclude_categories)}}else e(".wvr-add-review-rule").trigger("click")}{let t=e(".wvr-names-language-list");t.viDropdown({clearable:!0});const a=({value:e=[],text:t="",lang:a=""})=>{let n="default"!==a?'<span class="wvr-remove-lang-row"><i class="icon x"> </i></span>':"",r=0===wvrParams.languages.length&&"default"!==a?"wvr-hidden":"";return t=t?`Names in ${t}`:"",Array.isArray(e)&&(e=e.join("\n")),`<div class="wvr-names-row wvr-lang-textarea-row ${r}">\n                    <p class="wvr-names-row-label">${t}</p>\n                    <textarea name="wvr_names[${a}]" required>${e}</textarea>\n                    ${n}\n                </div>`};let n=wvrParams.settings.names||{};void 0!==n&&0!==Object.keys(n).length||(n={default:[]});for(let t in n)e(".wvr-names-field").append(a({text:wvrParams.languages[t],lang:t,value:n[t]}));e(".wvr-add-language-author").on("click",(function(){let n=t.viDropdown("get value"),r=t.viDropdown("get text"),l=a({text:r,lang:n});n&&e(".wvr-names-field").append(l),t.viDropdown("clear")}))}{const a=({lang:t="",text:a="",replys:n={}})=>{let r=0===wvrParams.languages.length&&"default"!==t?"wvr-hidden":"";const l=e=>{let a=n[e]||"";return Array.isArray(a)&&(a=a.join("\n")),`<div class="field">\n                        <p>Reply for ${e} &#9733;</p>\n                        <textarea name="wvr_reply_content[${t}][${e}]" data-source="${t}_${e}">${a}</textarea>\n                    </div>`};let i=e(`<div class="vi-ui styled fluid accordion wvr-language-row ${r}">\n                    <div class="active title">\n                        <i class="dropdown icon"> </i>\n                       <span class="wvr-language-title">${a}</span>\n                       ${"default"!==t?`<i class="dashicons dashicons-translation wvr-translate" data-lang="${t}"> </i><i class="x icon wvr-remove-language"> </i>`:""}\n                    </div>\n                    <div class="active content">\n                        ${l(5)}\n                        ${l(4)}\n                        ${l(3)}\n                        ${l(2)}\n                        ${l(1)}\n                    </div>\n                </div>`);return i.vi_accordion({selector:{trigger:".dropdown.icon"}}),i};let n=e(".wvr-replys-language-list");n.viDropdown({clearable:!0});let r=wvrParams.settings.reply_content||{};void 0!==r&&0!==Object.keys(r).length||(r={default:{1:"",2:"",3:"",4:"",5:""}});for(let t in r){let n=wvrParams.languages[t]||"";Object.keys(wvrParams.languages).length&&!n&&(n="Default language"),e(".wvr-reply-content-section").append(a({lang:t,text:n,replys:r[t]}))}e(".wvr-add-language-reply").on("click",(function(){let t=n.viDropdown("get value"),r=n.viDropdown("get text"),l=a({text:r,lang:t});t&&e(".wvr-reply-content-section").append(l),n.viDropdown("clear")})),e(".wvr-reply-author").select2({width:"100%",placeholder:"Search user",ajax:{url:wvrParams.ajaxUrl,dataType:"json",type:"POST",quietMillis:50,delay:250,data:e=>({...t,sub_action:"search_user",keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:e=>e,minimumInputLength:2})}{const t=({value:e=[],text:t="",lang:a=""})=>{let n="default"!==a?'<span class="wvr-remove-lang-row"><i class="icon x"> </i></span>':"";return Array.isArray(e)&&(e=e.join("\n")),t=t?`${t}`:"",`<div class="wvr-cmt-frontend-row wvr-lang-textarea-row ${0===wvrParams.languages.length&&"default"!==a?"wvr-hidden":""}">\n                    <p class="wvr-names-row-label">${t}</p>\n                    <textarea name="wvr_cmt_frontend[${a}]">${e}</textarea>\n                    ${n}\n                </div>`};let a=e(".wvr-cmt-frontend-language-list");a.viDropdown({clearable:!0});let n=wvrParams.settings.cmt_frontend||{};"object"==typeof n&&0!==Object.keys(n).length&&n.default||(n={default:""});for(let a in n){let r=wvrParams.languages[a]||"";e(".wvr-cmt-frontend-section").append(t({lang:a,text:r,value:n[a]}))}e(".wvr-add-language-cmt").on("click",(function(){let n=a.viDropdown("get value"),r=a.viDropdown("get text"),l=t({text:r,lang:n});n&&e(".wvr-cmt-frontend-section").append(l),a.viDropdown("clear")}))}}));