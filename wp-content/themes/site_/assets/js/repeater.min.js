!function(n){var e=acf.Field.extend({type:"repeater",wait:"",events:{'click a[data-event="add-row"]':"onClickAdd",'click a[data-event="duplicate-row"]':"onClickDuplicate",'click a[data-event="remove-row"]':"onClickRemove",'click a[data-event="collapse-row"]':"onClickCollapse",showField:"onShow",unloadField:"onUnload",mouseover:"onHover"},$control:function(){return this.$(".acf-repeater:first")},$table:function(){return this.$("table:first")},$tbody:function(){return this.$("tbody:first")},$rows:function(){return this.$("tbody:first > tr").not(".acf-clone")},$row:function(e){return this.$("tbody:first > tr:eq("+e+")")},$clone:function(){return this.$("tbody:first > tr.acf-clone")},$actions:function(){return this.$(".acf-actions:last")},$button:function(){return this.$(".acf-actions:last .button")},getValue:function(){return this.$rows().length},allowRemove:function(){var e=parseInt(this.get("min"));return!e||e<this.val()},allowAdd:function(){var e=parseInt(this.get("max"));return!e||e>this.val()},addSortable:function(i){1!=this.get("max")&&this.$tbody().sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,stop:function(e,t){i.render()},update:function(e,t){i.$input().trigger("change")}})},addCollapsed:function(){var t=i.load(this.get("key"));if(!t)return!1;this.$rows().each(function(e){-1<t.indexOf(e)&&n(this).addClass("-collapsed")})},addUnscopedEvents:function(i){this.on("invalidField",".acf-row",function(e){var t=n(this);i.isCollapsed(t)&&i.expand(t)})},initialize:function(){this.addUnscopedEvents(this),this.addCollapsed(),acf.disable(this.$clone(),this.cid),this.render()},render:function(){this.$rows().each(function(e){n(this).find("> .order > span").html(e+1)});var e=this.$control(),t=this.$button();0==this.val()?e.addClass("-empty"):e.removeClass("-empty"),this.allowAdd()?(e.removeClass("-max"),t.removeClass("disabled")):(e.addClass("-max"),t.addClass("disabled"))},validateAdd:function(){if(this.allowAdd())return!0;var e=this.get("max"),t=(t=acf.__("Maximum rows reached ({max} rows)")).replace("{max}",e);return this.showNotice({text:t,type:"warning"}),!1},onClickAdd:function(e,t){if(!this.validateAdd())return!1;t.hasClass("acf-icon")?this.add({before:t.closest(".acf-row")}):this.add()},add:function(i){if(!this.allowAdd())return!1;i=acf.parseArgs(i,{before:!1});var e=acf.duplicate({target:this.$clone(),append:this.proxy(function(e,t){(i.before||e).before(t),t.removeClass("acf-clone"),acf.enable(t,this.cid),this.render()})});return this.$input().trigger("change"),e},onClickDuplicate:function(e,t){if(!this.validateAdd())return!1;t=t.closest(".acf-row");this.duplicateRow(t)},duplicateRow:function(e){if(!this.allowAdd())return!1;var a=this.get("key"),e=acf.duplicate({target:e,rename:function(e,t,i,n){return"id"===e?t.replace(a+"-"+i,a+"-"+n):t.replace(a+"]["+i,a+"]["+n)},before:function(e){acf.doAction("unmount",e)},after:function(e,t){acf.doAction("remount",e)}});return this.$input().trigger("change"),this.render(),acf.focusAttention(e),e},validateRemove:function(){if(this.allowRemove())return!0;var e=this.get("min"),t=(t=acf.__("Minimum rows reached ({min} rows)")).replace("{min}",e);return this.showNotice({text:t,type:"warning"}),!1},onClickRemove:function(e,t){var i=t.closest(".acf-row");if(e.shiftKey)return this.remove(i);i.addClass("-hover");acf.newTooltip({confirmRemove:!0,target:t,context:this,confirm:function(){this.remove(i)},cancel:function(){i.removeClass("-hover")}})},remove:function(e){var t=this;acf.remove({target:e,endHeight:0,complete:function(){t.$input().trigger("change"),t.render()}})},isCollapsed:function(e){return e.hasClass("-collapsed")},collapse:function(e){e.addClass("-collapsed"),acf.doAction("hide",e,"collapse")},expand:function(e){e.removeClass("-collapsed"),acf.doAction("show",e,"collapse")},onClickCollapse:function(e,t){var i=t.closest(".acf-row"),t=this.isCollapsed(i);e.shiftKey&&(i=this.$rows()),t?this.expand(i):this.collapse(i)},onShow:function(e,t,i){var n=acf.getFields({is:":visible",parent:this.$el});acf.doAction("show_fields",n)},onUnload:function(){var t=[];this.$rows().each(function(e){n(this).hasClass("-collapsed")&&t.push(e)}),t=t.length?t:null,i.save(this.get("key"),t)},onHover:function(){this.addSortable(this),this.off("mouseover")}});acf.registerFieldType(e),acf.registerConditionForFieldType("hasValue","repeater"),acf.registerConditionForFieldType("hasNoValue","repeater"),acf.registerConditionForFieldType("lessThan","repeater"),acf.registerConditionForFieldType("greaterThan","repeater");var i=new acf.Model({name:"this.collapsedRows",key:function(e,t){var i=this.get(e+t)||0;return i++,this.set(e+t,i,!0),1<i&&(e+="-"+i),e},load:function(e){var e=this.key(e,"load"),t=acf.getPreference(this.name);return!(!t||!t[e])&&t[e]},save:function(e,t){var e=this.key(e,"save"),i=acf.getPreference(this.name)||{};null===t?delete i[e]:i[e]=t,n.isEmptyObject(i)&&(i=null),acf.setPreference(this.name,i)}})}(jQuery);